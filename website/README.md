# Conduit Website

The marketing website and documentation for Conduit, hosted at [getconduit.sh](https://getconduit.sh).

## Tech Stack

- **Framework**: [Astro](https://astro.build) with React components
- **Hosting**: [Cloudflare Pages](https://pages.cloudflare.com)
- **Documentation**: [mdBook](https://rust-lang.github.io/mdBook/)

## Development

### Prerequisites

- Node.js 18+
- pnpm
- [mdBook](https://rust-lang.github.io/mdBook/guide/installation.html) (for documentation)

### Local Development

```bash
# Install dependencies
pnpm install

# Start dev server (includes docs build)
pnpm dev

# Start dev server accessible from other machines on the network
pnpm dev -- --host 0.0.0.0
```

The site will be available at `http://localhost:4321` (or your network IP when using `--host`).

### Project Structure

```
website/
├── public/           # Static assets
│   └── docs/         # Built documentation (generated)
├── src/
│   ├── components/   # Astro/React components
│   ├── emails/       # Email templates
│   ├── layouts/      # Page layouts
│   └── pages/        # Route pages
└── dist/             # Build output (generated)

docs/
├── src/              # Documentation source (markdown)
├── book/             # Built docs (generated by mdBook)
└── book.toml         # mdBook configuration
```

## Building

### Build Everything

```bash
pnpm build
```

This command:
1. Builds the documentation with mdBook (`docs/` → `docs/book/`)
2. Copies docs to `public/docs/`
3. Builds the Astro site to `dist/`

### Build Docs Only

```bash
# From website directory
pnpm build:docs

# Or from root
cd docs && mdbook build
```

## Deployment

The website is deployed to Cloudflare Pages.

### Deploy to Production

```bash
# Build first
pnpm build

# Deploy (will warn if there are uncommitted changes)
npx wrangler pages deploy dist --project-name=getconduit-sh --branch=main

# Deploy with uncommitted changes (skip the warning)
npx wrangler pages deploy dist --project-name=getconduit-sh --branch=main --commit-dirty=true
```

### Quick Deploy (one command)

```bash
pnpm build && npx wrangler pages deploy dist --project-name=getconduit-sh --branch=main --commit-dirty=true
```

> **Important**: The `--branch=main` flag is required for production deployment. Other branches (`master`, `production`, etc.) will only deploy to preview URLs.

### Troubleshooting Deployment

If documentation changes aren't appearing after deployment:

1. **Clean the mdBook cache**: The mdBook build caches output. Force a clean rebuild:
   ```bash
   rm -rf ../docs/book public/docs
   pnpm build
   ```

2. **Verify the build output**:
   ```bash
   grep "Quick Install" dist/docs/getting-started/installation.html
   ```

3. **Force fresh upload**: If Cloudflare shows "0 files uploaded", the content hashes match cached files. This usually means the build picked up stale cache - try the clean rebuild above.

## Documentation

Documentation source files are in `docs/src/`. The docs use [mdBook](https://rust-lang.github.io/mdBook/).

### Editing Documentation

1. Edit markdown files in `docs/src/`
2. Update `docs/src/SUMMARY.md` if adding new pages
3. Preview locally: `cd docs && mdbook serve`
4. Build and deploy (see above)

### Documentation Structure

- `docs/src/SUMMARY.md` - Table of contents
- `docs/src/introduction.md` - Landing page
- `docs/src/getting-started/` - Installation, quick start, first session
- `docs/src/concepts/` - Core concepts (agents, sessions, etc.)
- `docs/src/configuration/` - Config file, themes, keybindings
- `docs/src/shortcuts/` - Keyboard shortcuts reference
- `docs/src/ui/` - UI components documentation
- `docs/src/advanced/` - Advanced topics

## Environment Variables

Create a `.env` file based on `.env.example`:

```bash
cp .env.example .env
```

Required variables:
- `TURSO_DATABASE_URL` - Database connection
- `TURSO_AUTH_TOKEN` - Database auth
- `RESEND_API_KEY` - Email sending
- `GITHUB_CLIENT_ID` / `GITHUB_CLIENT_SECRET` - GitHub OAuth
